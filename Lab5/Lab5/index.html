
<!DOCTYPE html>

<html>

<head>
<title>WebGL Lab &mdash; 5 </title>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">

<script id="shader-vs" type="x-shader/x-vertex">
precision mediump float;
    attribute vec3 aVertexPosition;
    attribute vec3 aVertexNormal;
    attribute vec2 aVertexUV;

    uniform mat4 uMVPMatrix;
    uniform mat4 uMVMatrix;
    uniform mat4 uNMatrix;

    varying vec4 vColor; 
    varying vec3 vNormal_CameraSpace;
    varying vec3 vVertexPos_CameraSpace;
    varying vec2 vVertexUV;

    void main(void) {
        gl_Position = uMVPMatrix * vec4( aVertexPosition, 1.0 );
      //  vColor = aVertexColor; 
        vNormal_CameraSpace = vec3( uNMatrix * vec4( aVertexNormal, 0.0 ) );
        vVertexPos_CameraSpace = vec3( uMVMatrix * vec4( aVertexPosition, 1.0 ) );
        vVertexUV = aVertexUV;
    }
</script>

<script id="shader-fs" type="x-shader/x-fragment">
precision mediump float;
   // varying vec4 vColor; 
    varying vec3 vNormal_CameraSpace;
    varying vec3 vVertexPos_CameraSpace;
    varying vec2 vVertexUV;

    uniform vec3 uLightPos_CameraSpace;

    uniform vec4 uLightAmbient; 
    uniform vec4 uLightDiffuse; 
    uniform vec4 uLightSpecular;

    uniform float uShininess;

    uniform vec4 uMaterialAmbient; 
    uniform vec4 uMaterialDiffuse; 
    uniform vec4 uMaterialSpecular;

    uniform sampler2D uMeshTexture; 

    void main(void) 
        {
        vec4 texColor = texture2D( uMeshTexture, vVertexUV ); 

        vec3 lightVec = normalize( vec3( uLightPos_CameraSpace - vVertexPos_CameraSpace ) ); 

        vec3 eyeVec = normalize( -vec3( vVertexPos_CameraSpace ) );
        
        float ndotl = max( dot( vNormal_CameraSpace, lightVec ), 0.0 ); 

        vec4 diffuse = uLightDiffuse * ndotl;

        vec3 reflectVec = normalize( 2.0 * ndotl * vNormal_CameraSpace - lightVec );
        
        float rdotv = max( dot( reflectVec, eyeVec ), 0.0 );

        vec4 specular = vec4( 0, 0, 0, 1); 
        if ( ndotl > 0.0 ) 
            specular = uLightSpecular * pow( rdotv, uShininess ); 

        gl_FragColor = texColor * ( uLightAmbient * uMaterialAmbient + diffuse * uMaterialDiffuse ) + specular * uMaterialSpecular; 
        gl_FragColor.a = 1.0;
        //gl_FragColor = texColor;
       // gl_FragColor = uLightAmbient;
      //  gl_FragColor = vec4( vNormal, 1.0 );
        }
</script>

<script id="textureShader-vs" type="x-shader/x-vertex">
precision mediump float;
    attribute vec2 aVertexPosition;
    attribute vec2 aVertexUV;

    varying vec2 vVertexUV;

    void main(void) {
        vVertexUV = aVertexUV;
        gl_Position = vec4( aVertexPosition, 0, 1 );
    }
</script>

<script id="textureShader-fs" type="x-shader/x-fragment">
precision mediump float;
varying vec2 vVertexUV;

uniform sampler2D uTexture; 

void main(void) 
    {
    gl_FragColor = texture2D( uTexture, vVertexUV ); 
    }
</script>

<script id="deferredShader-vs" type="x-shader/x-vertex">
    precision highp float;
    attribute vec3 aVertexPosition;
    
    uniform mat4 uMVPMatrix;
    
    varying vec3 vPosition_WorldSpace;
    void main(void) {
        gl_Position = uMVPMatrix * vec4( aVertexPosition, 1 );
        vPosition_WorldSpace = vec3( gl_Position.x / gl_Position.w, gl_Position.y / gl_Position.w, gl_Position.z / gl_Position.w );
    }
</script>

 <script id="deferredShader-fs" type="x-shader/x-fragment">
#extension GL_EXT_draw_buffers : require
    precision highp float;

    varying vec3 vPosition_WorldSpace;
void main(void) 
    {
     //depth = gl_FragCoord.z;
    gl_FragData[0] = vec4( vPosition_WorldSpace, 1 ); 
    }
</script>

<script type="text/javascript" src="scripts\gl-matrix\common.js"></script>
<script type="text/javascript" src="scripts\gl-matrix\mat2.js"></script>
<script type="text/javascript" src="scripts\gl-matrix\mat2d.js"></script>
<script type="text/javascript" src="scripts\gl-matrix\mat3.js"></script>
<script type="text/javascript" src="scripts\gl-matrix\mat4.js"></script>
<script type="text/javascript" src="scripts\gl-matrix\vec3.js"></script>
<script type="text/javascript" src="scripts\gl-matrix\vec4.js"></script>
<script type="text/javascript" src="scripts\gl-matrix\quat.js"></script>
<script type="text/javascript" src="scripts\gl-matrix\vec2.js"></script>


<script type="text/javascript" src="scripts\webgl-utils.js"></script>
<script type="text/javascript" src="scripts\Resource.js"></script>
<script type="text/javascript" src="scripts\ShaderResource.js"></script>

<script type="text/javascript" src="scripts\GlobalConstants.js"></script>
<script type="text/javascript" src="scripts\Controller.js"></script>
<script type="text/javascript" src="scripts\CameraController.js"></script>
<script type="text/javascript" src="scripts\RobotController.js"></script>
<script type="text/javascript" src="scripts\Transform.js"></script>
<script type="text/javascript" src="scripts\TransformStack.js"></script>
<script type="text/javascript" src="scripts\Scene.js"></script>
<script type="text/javascript" src="scripts\SceneNodes.js"></script>
<script type="text/javascript" src="scripts\CameraNode.js"></script>
<script type="text/javascript" src="scripts\GeometrySceneNodes.js"></script>
<script type="text/javascript" src="scripts\MeshSceneNodes.js"></script>
<script type="text/javascript" src="scripts\PointLightSceneNode.js"></script>
<script type="text/javascript" src="scripts\shaders_setup.js"></script>
<script type="text/javascript" src="scripts\Main.js"></script>
<script type="text/javascript" src="scripts\TextureDrawer.js"></script>
<script type="text/javascript" src="scripts\DeferredDrawer.js"></script>

</head>


<body onload="webGLStart();">

    <canvas id="WebGL-canvas" style="border: none;" width="1024" height="512"></canvas>

    <br/>

    <h4 id="LightControlOption">- Control your light</br> </br> </h4> 

    <h4 id="CameraControlOption">- Control your camera</br> </br> </h4> 
</body>


</html>

